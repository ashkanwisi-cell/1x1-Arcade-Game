<!DOCTYPE html>
<html lang="fa">
<head>
  <meta charset="UTF-8">
  <title>Focus Zone â€“ Online Scores</title>
  <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

  <!-- ÙÙˆÙ†Øª Ø­Ø±ÙÙ‡â€ŒØ§ÛŒ Ø¨Ø±Ø§ÛŒ UI -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Inter', sans-serif;
    }

    body {
      height: 100vh;
      background: radial-gradient(circle at top, #222 0, #050509 60%, #000 100%);
      color: #f5f5f5;
      direction: rtl;
      overflow: hidden;
      touch-action: none;
      -webkit-user-select: none;
      user-select: none;
    }

    .app {
      width: 100vw;
      max-width: 480px;
      height: 100vh;
      margin: 0 auto;
      padding: 2.5vh 4vw;
      display: flex;
      flex-direction: column;
      gap: 2vh;
    }

    /* Liquid Glass */
    .glass {
      background: linear-gradient(135deg, rgba(255,255,255,0.12), rgba(255,255,255,0.03));
      border-radius: 20px;
      border: 1px solid rgba(255,255,255,0.17);
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      box-shadow: 0 12px 28px rgba(0,0,0,0.5);
    }

    .header {
      padding: 1.4vh 3vw;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .title {
      font-size: 4.2vw;
      font-weight: 600;
    }

    .subtitle {
      font-size: 3vw;
      opacity: .7;
      margin-top: .4vh;
    }

    .score-block {
      text-align: left;
      font-size: 3.2vw;
    }
    .score-label {
      font-size: 2.6vw;
      opacity: .65;
    }
    .score-value {
      font-size: 3.4vw;
      font-weight: 600;
    }

    .sound-toggle {
      min-width: auto;
      padding: .4vh 1.8vw;
      font-size: 3.4vw;
      border-radius: 12px;
      border: 1px solid rgba(255,255,255,0.25);
      background: rgba(255,255,255,0.15);
      backdrop-filter: blur(12px);
    }

    /* Game Area */
    .game-area {
      position: relative;
      width: 100%;
      height: 46vh;
      border-radius: 18px;
      background: radial-gradient(circle at top, #202633 0, #05070b 65%);
      border: 1px solid rgba(255,255,255,0.1);
      overflow: hidden;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .line {
      width: 86%;
      height: 1.1vh;
      background: #30343d;
      border-radius: 999px;
      box-shadow: inset 0 0 6px rgba(0,0,0,0.7);
      position: relative;
    }

    /* Ø²ÙˆÙ† Ø¨Ø²Ø±Ú¯â€ŒØªØ±: Û´Û°Ùª Ø·ÙˆÙ„ Ø®Ø· */
    .zone {
      position: absolute;
      top: -0.8vh;
      height: 2.8vh;
      border-radius: 999px;
      background: linear-gradient(90deg, #35ffb4, #00cfff);
      box-shadow: 0 0 14px rgba(22,255,204,0.9);
      opacity: .95;
    }

    .ball {
      width: 3.2vh;
      height: 3.2vh;
      position: absolute;
      top: -1.6vh;
      border-radius: 50%;
      background: radial-gradient(circle at 30% 25%, #fff8c1, #ffd600);
      box-shadow: 0 0 12px rgba(255,214,0,0.9);
      transform: translateX(-50%);
    }

    /* Menu overlay */
    .overlay {
      position: absolute;
      inset: 0;
      background: rgba(8,10,15,0.92);
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      text-align: center;
      padding: 2vh 3vw;
      z-index: 5;
      gap: 1.2vh;
    }
    .overlay.hidden {
      display: none;
    }

    .overlay-title {
      font-size: 4.6vw;
      font-weight: 600;
    }
    .overlay-score {
      font-size: 3.4vw;
      opacity: .8;
    }
    .overlay-hint {
      font-size: 3vw;
      opacity: .7;
      line-height: 1.6;
      margin-top: 1vh;
    }

    .btn-row {
      display: flex;
      gap: 2.5vw;
      margin-top: 1.8vh;
    }

    .btn {
      min-width: 26vw;
      padding: 1.1vh 2.4vw;
      border-radius: 14px;
      font-size: 3.3vw;
      font-weight: 600;
      background: rgba(255,255,255,0.25);
      border: 1px solid rgba(255,255,255,0.30);
      backdrop-filter: blur(16px);
      transition: 0.1s;
    }
    .btn:active {
      transform: scale(.97);
    }

    .btn-secondary {
      background: rgba(255,255,255,0.15);
    }
  </style>
</head>
<body>

<div class="app">

  <div class="header glass">
    <div>
      <div class="title">Focus Zone</div>
      <div class="subtitle">Ø¨Ø§Ø²ÛŒ ØªÙ…Ø±Ú©Ø² â€“ ÛŒÚ© Ø§Ù†Ú¯Ø´Øª</div>
    </div>

    <div>
      <div class="score-label">Ø§Ù…ØªÛŒØ§Ø²</div>
      <div class="score-value" id="score">0.0</div>
      <br>
      <div class="score-label">Ø¨Ù‡ØªØ±ÛŒÙ†</div>
      <div class="score-value" id="best">0.0</div>
    </div>

    <button id="soundBtn" class="sound-toggle">ğŸ”Š</button>
  </div>

  <div class="game-area" id="gameArea">
    <div class="line" id="line">
      <div class="zone" id="zone"></div>
      <div class="ball" id="ball"></div>
    </div>

    <div class="overlay" id="overlay">
      <div class="overlay-title" id="overlayTitle">Ø´Ø±ÙˆØ¹ Ø¨Ø§Ø²ÛŒ</div>
      <div class="overlay-score" id="overlayScore"></div>
      <div class="overlay-hint">
        ØªÙˆÙ¾ Ø±ÙˆÛŒ Ø®Ø· Ø­Ø±Ú©Øª Ù…ÛŒâ€ŒÚ©Ù†Ø¯.  
        Ø¨Ø§ Ù‡Ø± Ø¶Ø±Ø¨Ù‡ Ø±ÙˆÛŒ ØµÙØ­Ù‡ØŒ Ù…Ø³ÛŒØ± ØªÙˆÙ¾ Ø¨Ø±Ø¹Ú©Ø³ Ù…ÛŒâ€ŒØ´ÙˆØ¯.  
        Ø§Ú¯Ø± ØªÙˆÙ¾ Ø§Ø² Ø²ÙˆÙ† Ø®Ø§Ø±Ø¬ Ø´ÙˆØ¯ â†’ Ù…ÛŒâ€ŒØ¨Ø§Ø²ÛŒ.
      </div>

      <div class="btn-row">
        <button class="btn" id="startBtn">â–¶ Ø´Ø±ÙˆØ¹</button>
        <button class="btn btn-secondary" id="restartBtn">âŸ³ Ø±ÛŒØ³Øª</button>
      </div>
    </div>
  </div>

</div>

<!-- ğŸ”¥ Firebase: Ø°Ø®ÛŒØ±Ù‡â€ŒÚ©Ø±Ø¯Ù† score Ø¯Ø± Firestore -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
  import { getFirestore, collection, addDoc }
    from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";

  // âš ï¸ Ø§ÛŒÙ† Ù‡Ù…Ø§Ù† config Ø®ÙˆØ¯Øª Ø§Ø³Øª
  const firebaseConfig = {
    apiKey: "AIzaSyCvTE8pWDpfP8uKzB5CnRkaa6aEK6u-7JQ",
    authDomain: "adan-f630c.firebaseapp.com",
    projectId: "adan-f630c",
    storageBucket: "adan-f630c.firebasestorage.app",
    messagingSenderId: "116112699236",
    appId: "1:116112699236:web:a4fbe09161bf2e781b9471",
    measurementId: "G-Q6MZBGZERG"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  async function saveScoreToFirebase(score) {
    try {
      await addDoc(collection(db, "scores"), {
        score: score,
        createdAt: new Date().toISOString(),
        ua: navigator.userAgent || null
      });
      console.log("Score saved to Firebase:", score);
    } catch (err) {
      console.error("Error saving score to Firebase:", err);
    }
  }

  // ØªØ§ Ø§Ø³Ú©Ø±ÛŒÙ¾Øª Ø¨Ø§Ø²ÛŒ Ø¨ØªÙˆØ§Ù†Ø¯ ØµØ¯Ø§ Ø¨Ø²Ù†Ø¯:
  window.saveScoreToFirebase = saveScoreToFirebase;
</script>

<!-- ğŸ® Ø§Ø³Ú©Ø±ÛŒÙ¾Øª Ø§ØµÙ„ÛŒ Ø¨Ø§Ø²ÛŒ -->
<script>
  const line = document.getElementById("line");
  const zone = document.getElementById("zone");
  const ball = document.getElementById("ball");

  const overlay = document.getElementById("overlay");
  const overlayTitle = document.getElementById("overlayTitle");
  const overlayScore = document.getElementById("overlayScore");
  const startBtn = document.getElementById("startBtn");
  const restartBtn = document.getElementById("restartBtn");

  const scoreEl = document.getElementById("score");
  const bestEl = document.getElementById("best");
  const soundBtn = document.getElementById("soundBtn");

  let soundEnabled = true;
  let audioCtx = null;

  function ensureAudio() {
    if (!audioCtx) {
      const AC = window.AudioContext || window.webkitAudioContext;
      if (AC) audioCtx = new AC();
    }
  }

  function playBeep(freq, dur, type = "sine", v = 0.15) {
    if (!soundEnabled || !audioCtx) return;
    const osc = audioCtx.createOscillator();
    const g = audioCtx.createGain();
    osc.type = type;
    osc.frequency.value = freq;
    osc.connect(g);
    g.connect(audioCtx.destination);
    g.gain.value = v;
    const now = audioCtx.currentTime;
    osc.start(now);
    g.gain.exponentialRampToValueAtTime(0.0001, now + dur);
    osc.stop(now + dur);
  }

  let lineWidth;
  let zoneWidth, zoneLeft, zoneRight;
  let ballX = 0;
  let ballSpeed = 0;
  let zoneSpeed = 0;

  let running = false;
  let gameOver = false;
  let startTime = null;
  let lastTime = null;
  let score = 0;
  let bestScore = 0;

  function setupGeometry() {
    const rect = line.getBoundingClientRect();
    lineWidth = rect.width;

    // Ø²ÙˆÙ† = Û´Û°Ùª Ø·ÙˆÙ„ Ø®Ø·
    zoneWidth = lineWidth * 0.40;
    zoneLeft = (lineWidth - zoneWidth) / 2;
    zoneRight = zoneLeft + zoneWidth;

    zone.style.width = zoneWidth + "px";
    zone.style.left = zoneLeft + "px";

    ballX = zoneLeft + zoneWidth / 2;
    ball.style.left = ballX + "px";
  }

  function resetGame() {
    setupGeometry();
    running = false;
    gameOver = false;
    score = 0;
    scoreEl.textContent = "0.0";
    lastTime = null;
    startTime = null;

    ballSpeed = 2.8;
    zoneSpeed = 0.9;
  }

  function startGame() {
    resetGame();
    running = true;
    overlay.classList.add("hidden");
    requestAnimationFrame(loop);
  }

  function endGame() {
    running = false;
    gameOver = true;

    // ğŸ”¥ Ø°Ø®ÛŒØ±Ù‡ Ø§Ù…ØªÛŒØ§Ø² Ø¯Ø± Firebase
    if (window.saveScoreToFirebase) {
      window.saveScoreToFirebase(score);
    }

    if (score > bestScore) {
      bestScore = score;
      bestEl.textContent = bestScore.toFixed(1);
      try {
        localStorage.setItem("focusZoneBest_full", bestScore.toString());
      } catch (e) {}
    }

    overlayTitle.textContent = "Ø¨Ø§Ø®ØªÛŒ!";
    overlayScore.textContent =
      "Ø§Ù…ØªÛŒØ§Ø²: " + score.toFixed(1) + " â€¢ Ø±Ú©ÙˆØ±Ø¯: " + bestScore.toFixed(1);
    overlay.classList.remove("hidden");

    ensureAudio();
    playBeep(220, 0.25, "square", 0.2);
  }

  function loop(ts) {
    if (!running) return;

    if (!lastTime) {
      lastTime = ts;
      startTime = ts;
      requestAnimationFrame(loop);
      return;
    }

    const delta = (ts - lastTime) / 16.67;
    lastTime = ts;

    // Ø­Ø±Ú©Øª ØªÙˆÙ¾
    ballX += ballSpeed * delta;
    ball.style.left = ballX + "px";

    // Ø­Ø±Ú©Øª Ø²ÙˆÙ†
    zoneLeft += zoneSpeed * delta;
    zoneRight = zoneLeft + zoneWidth;
    if (zoneLeft < 0) {
      zoneLeft = 0;
      zoneSpeed = Math.abs(zoneSpeed);
    } else if (zoneRight > lineWidth) {
      zoneRight = lineWidth;
      zoneLeft = zoneRight - zoneWidth;
      zoneSpeed = -Math.abs(zoneSpeed);
    }
    zone.style.left = zoneLeft + "px";

    // Ø§Ù…ØªÛŒØ§Ø²
    const elapsed = (ts - startTime) / 1000;
    score = elapsed;
    scoreEl.textContent = score.toFixed(1);

    // Ø³Ø®Øªâ€ŒØªØ± Ø´Ø¯Ù†
    const base = 2.8, max = 4;
    const f = Math.min(elapsed / 20, 1);
    const newSpeed = base + max * f;
    ballSpeed = ballSpeed < 0 ? -newSpeed : newSpeed;

    const zoneBase = 0.9, zoneMax = 2;
    const zNew = zoneBase + zoneMax * f;
    zoneSpeed = zoneSpeed < 0 ? -zNew : zNew;

    // Ø®Ø§Ø±Ø¬ Ø´Ø¯Ù† ØªÙˆÙ¾ Ø§Ø² Ø²ÙˆÙ†
    if (ballX < zoneLeft || ballX > zoneRight) {
      endGame();
      return;
    }

    requestAnimationFrame(loop);
  }

  function handleTap() {
    ensureAudio();
    if (!running && !gameOver) {
      startGame();
      playBeep(520, 0.12);
    } else if (!running && gameOver) {
      startGame();
    } else {
      // Ø¯Ø± Ø­ÛŒÙ† Ø¨Ø§Ø²ÛŒ: Ø¨Ø±Ø¹Ú©Ø³ Ø´Ø¯Ù† Ø¬Ù‡Øª ØªÙˆÙ¾
      ballSpeed = -ballSpeed;
      playBeep(650, 0.09);
    }
  }

  document.addEventListener("touchstart", function (e) {
    if (!e.target.closest(".btn")) {
      e.preventDefault();
      handleTap();
    }
  }, { passive: false });

  document.addEventListener("click", function (e) {
    if (!e.target.closest(".btn")) {
      handleTap();
    }
  });

  startBtn.addEventListener("click", function (e) {
    e.stopPropagation();
    handleTap();
  });

  restartBtn.addEventListener("click", function (e) {
    e.stopPropagation();
    resetGame();
    overlayTitle.textContent = "Ø´Ø±ÙˆØ¹ Ø¯ÙˆØ¨Ø§Ø±Ù‡";
    overlayScore.textContent = "";
  });

  soundBtn.addEventListener("click", function (e) {
    e.stopPropagation();
    soundEnabled = !soundEnabled;
    soundBtn.textContent = soundEnabled ? "ğŸ”Š" : "ğŸ”ˆ";
    ensureAudio();
    if (soundEnabled) playBeep(700, 0.07);
  });

  window.addEventListener("load", function () {
    setupGeometry();
    try {
      const saved = localStorage.getItem("focusZoneBest_full");
      if (saved) {
        bestScore = parseFloat(saved);
        bestEl.textContent = bestScore.toFixed(1);
      }
    } catch (e) {}
  });

  window.addEventListener("resize", function () {
    setupGeometry();
  });
</script>

</body>
</html>
